{% extends "league/base.html" %}
{% load static %}
{% block content %}

<div class="min-h-screen bg-gradient-to-b from-[#0b2f2f] via-[#0f3d4c] to-[#0b2f2f] text-white px-4 py-10">

  <div class="max-w-5xl mx-auto space-y-14">

    <!-- PLAYER HEADER -->
    <div class="text-center space-y-3">
      <h1 class="text-4xl font-extrabold tracking-wide text-yellow-300 drop-shadow-lg">
        {{ player.gamertag }}
      </h1>
      <p class="text-blue-200/80 text-sm">
        {{ player.position }} â€” {{ player.club.name }}
      </p>
    </div>

    <!-- SEASON STATS -->
    <section>
      <h2 class="text-2xl font-bold mb-4 text-yellow-300">Season Stats</h2>

      {% if stats %}
      <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-4">

        <div class="bg-white/5 border border-white/10 rounded-xl p-4 text-center backdrop-blur-xl shadow-xl">
          <p class="text-blue-200 text-xs uppercase">Apps</p>
          <p class="text-yellow-300 text-xl font-bold">{{ stats.appearances }}</p>
        </div>

        <div class="bg-white/5 border border-white/10 rounded-xl p-4 text-center backdrop-blur-xl shadow-xl">
          <p class="text-blue-200 text-xs uppercase">Goals</p>
          <p class="text-yellow-300 text-xl font-bold">{{ stats.goals }}</p>
        </div>

        <div class="bg-white/5 border border-white/10 rounded-xl p-4 text-center backdrop-blur-xl shadow-xl">
          <p class="text-blue-200 text-xs uppercase">Assists</p>
          <p class="text-yellow-300 text-xl font-bold">{{ stats.assists }}</p>
        </div>

        <div class="bg-white/5 border border-white/10 rounded-xl p-4 text-center backdrop-blur-xl shadow-xl">
          <p class="text-blue-200 text-xs uppercase">Clean Sheets</p>
          <p class="text-yellow-300 text-xl font-bold">{{ stats.clean_sheets }}</p>
        </div>

        <div class="bg-white/5 border border-white/10 rounded-xl p-4 text-center backdrop-blur-xl shadow-xl">
          <p class="text-blue-200 text-xs uppercase">AMR</p>
            <p class="text-yellow-300 text-xl font-bold">
            {% if stats and stats.rating %}
              {{ stats.rating|floatformat:2 }}
            {% else %}
              --
            {% endif %}
          </p>
        </div>

        <div class="bg-white/5 border border-white/10 rounded-xl p-4 text-center backdrop-blur-xl shadow-xl">
          <p class="text-blue-200 text-xs uppercase">MOTM</p>
          <p class="text-yellow-300 text-xl font-bold">{{ motm_count }}</p>
        </div>

      </div>
      {% else %}
      <p class="text-blue-200/70">No stats available for this season.</p>
      {% endif %}
    </section>

    <!-- MATCH-BY-MATCH STATS -->
    <section>
      <h2 class="text-2xl font-bold mb-4 text-yellow-300">Match Performance</h2>

      {% if match_stats %}
      <div class="overflow-x-auto">
        <table class="w-full text-left border-collapse bg-white/5 border border-white/10 rounded-2xl backdrop-blur-xl shadow-xl">
          <thead class="bg-white/10 text-blue-200 uppercase text-xs tracking-wider">
            <tr>
              <th class="px-4 py-3">Match</th>
              <th class="px-4 py-3 text-center">Goals</th>
              <th class="px-4 py-3 text-center">Assists</th>
              <th class="px-4 py-3 text-center">Rating</th>
              <th class="px-4 py-3 text-center">Minutes</th>
            </tr>
          </thead>

          <tbody class="text-sm">
            {% for s in match_stats %}
            <tr class="border-t border-white/10 hover:bg-white/10 transition">

              <td class="px-4 py-3 font-semibold text-blue-200">
                {% if s.group_match %}
                <a href="{% url 'ppl3_match_detail' s.group_match.id %}" class="hover:text-yellow-300 transition">
                  <!-- GROUP MATCH -->
                  {{ s.group_match.fixture.home_club.name }} vs {{ s.group_match.fixture.away_club.name }}
                </a>
                {% elif s.knockout_match %}
                <a href="{% url 'ppl3_match_detail' s.knockout_match.id %}" class="hover:text-yellow-300 transition">
                  <!-- KNOCKOUT MATCH -->
                  {{ s.knockout_match.home_club.name|default:s.knockout_match.home_placeholder }}
                  vs
                  {{ s.knockout_match.away_club.name|default:s.knockout_match.away_placeholder }}
                </a>
                {% elif s.fixture %}
                <a href="{% url 'ppl3_match_detail' s.fixture.id %}" class="hover:text-yellow-300 transition">
                  <!-- Direct Fixture -->
                  {{ s.fixture.home_club.name }} vs {{ s.fixture.away_club.name }}
                </a>
                {% else %}
                <span class="text-blue-200">(match)</span>
                {% endif %}
              </td>

              <td class="px-4 py-3 text-center">{{ s.goals }}</td>
              <td class="px-4 py-3 text-center">{{ s.assists }}</td>
              <td class="px-4 py-3 text-center text-yellow-300 font-bold">{{ s.rating }}</td>
              <td class="px-4 py-3 text-center">{{ s.minutes_played }}</td>

            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p class="text-blue-200/70">No match stats available.</p>
      {% endif %}
    </section>

  </div>
</div>

{% endblock %}
